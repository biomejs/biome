name: Publish to WinGet

on:
  release:
    types: [published]

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  publish-winget:
    name: Publish to WinGet
    runs-on: windows-latest
    # Only run for CLI releases (not JS API releases)
    if: startsWith(github.event.release.tag_name, '@biomejs/biome@')
    steps:
      - name: Extract version from tag
        id: extract-version
        run: |
          $tag = "${{ github.event.release.tag_name }}"
          $version = $tag -replace '^@biomejs/biome@', ''
          echo "version=$version" >> $env:GITHUB_OUTPUT
          echo "Extracted version: $version"
        shell: pwsh

      - name: Publish to WinGet
        uses: vedantmgoyal9/winget-releaser@v2
        with:
          identifier: BiomeJS.Biome
          version: ${{ steps.extract-version.outputs.version }}
          token: ${{ secrets.WINGET_TOKEN }} 
